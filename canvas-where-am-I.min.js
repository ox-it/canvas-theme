(async function(){async function a(a,b){const c=`${j}/${a}/${b}.json`,d=await fetch(c).then(h).then(function(a){const b=a["modules-navigation"];return console.log("Modules Navigation Enabled: "+b),b}).catch(function(){return console.log("Failed to load settings"),!1});return d}async function b(a,c){const d=c?c:`/api/v1/courses/${a}/modules?include=items&per_page=100`;let e=await fetch(d,{method:"GET",credentials:"include",headers:{Accept:"application/json"}}).then(g).then(async c=>{let d=await c.json();const e=c.headers.get("link"),f=e.split(","),g=f.find(a=>a.includes("rel=\"next\""));if(g){const c=g.replace(">; rel=\"next\"","").replace("<",""),e=await b(a,c);d=d.concat(e)}return d}).catch(function(a){return console.log("Failed to get course modules",a),[]});return e}function c(a,b){const c=["#873597","#872434","#721627","#043946","#595959","#B10E31","#275D86","#333333","#09332b","#365E6C","#365D74","#8E4402","#330d14","#3D5D70","#00152e","#595D00","#63583E","#5F584F","#814C1E","#0B5F86","#353c47","#000000","#005E8F","#5D594C","#3B5C77","#1C5E86","#466127","#9B3547","#001c3d","#0D6454","#A82824","#914200","#5E5854","#002147","#615751","#6D5606","#A13223","#7a736e","#003947","#193658","#122f53","#635746","#13635E","#AC2121","#275C87"];let d=document.createElement("div");d.id="module_nav",d.className="ou-ModuleCard__box";let e=document.createElement("a");e.id="module_nav_anchor",d.appendChild(e);let f;return b.forEach((b,e)=>{0==e%4&&(f=document.createElement("div"),f.className="grid-row center-sm",d.appendChild(f));var g=document.createElement("div");g.className="col-xs-12 col-sm-6 col-lg-3",f.appendChild(g);let h=document.createElement("div");h.className="ou-ModuleCard",h.title=b.name;let i=document.createElement("a");i.href=`/courses/${a}/modules/${b.id}`;const j=e%c.length;let k=document.createElement("div");k.className="ou-ModuleCard__header_hero_short",k.style.backgroundColor=c[j];let l=document.createElement("div");l.className="ou-ModuleCard__header_content";var m=document.createElement("div");m.classList.add("ou-ModuleCard__header-title"),m.classList.add("ellipsis"),m.title=b.name,m.style.color=c[j],m.appendChild(document.createTextNode(b.name)),m.classList.add("ou-no-actions"),l.appendChild(m),i.appendChild(k),i.appendChild(l),h.appendChild(i),g.appendChild(h)}),d}function d(a,b,c,d){let e=document.createElement("ul");return e.className="ou-section-tabs-sub",b.forEach(b=>{let f=document.createElement("li");f.className="ou-section-sub";let g=document.createElement("a");g.className="ou-section-link-sub",g.title=b.name,g.href=`/courses/${a}/modules/${b.id}`,g.appendChild(document.createTextNode(b.name)),!1;const h=b.items.find(a=>a.id===d);if(b.id===c||h){const a=document.querySelector("li.section > a.active");a.classList.remove("active"),g.classList.add("active")}f.appendChild(g),e.appendChild(f)}),e}function e(a,b,c){let d=[];return c.items.forEach(c=>{if("SubHeader"===c.type)return;let e=c.id,f=c.type,g=i(f);let h=b===c.id,j={href:`/courses/${a}/modules/items/${e}`,title:c.title,icon:g,current:h};d.push(j)}),d}function f(a){let b=document.createElement("div");b.classList.add("ou-ColContainer");let c=document.createElement("div");c.classList.add("ou-LeftCol");let d=document.createElement("div");d.classList.add("ou-CentreCol");let e=document.createElement("div");e.classList.add("ou-RightCol"),b.appendChild(c),b.appendChild(d),b.appendChild(e);const f=document.querySelector("a.module-sequence-footer-button--previous");f&&c.appendChild(f);const g=document.querySelector("span.module-sequence-footer-button--next");g&&e.appendChild(g);let h=document.createElement("div");h.className="ou-progress-icons";let i=document.createElement("ul");return i.className="ou-progress-items",a.forEach(a=>{let b=document.createElement("li");b.className="ou-progress-item";let c=document.createElement("a");c.classList.add(a.icon),a.current&&c.classList.add("active"),c.href=a.href,c.title=a.title,b.appendChild(c),i.appendChild(b)}),h.appendChild(i),d.appendChild(h),b}function g(a){return 200<=a.status&&300>a.status?Promise.resolve(a):Promise.reject(new Error(a.statusText))}function h(a){return a.json()}function i(a){return"Page"===a?"icon-document":"File"===a?"icon-paperclip":"Discussion"===a?"icon-discussion":"Quiz"===a?"icon-quiz":"Assignment"===a?"icon-assignment":"ExternalUrl"===a?"icon-link":"icon-document"}let j=null;switch(window.location.hostname){case"canvas.ox.ac.uk":j="https://oxctl-cpn-settings-prod.s3-eu-west-1.amazonaws.com";break;case"oxeval.instructure.com":case"universityofoxford.beta.instructure.com":default:j=`https://oxctl-modules.s3-eu-west-1.amazonaws.com`;}const k=document.getElementById("course_home_content"),l=document.getElementById("content"),m=document.getElementById("context_modules_sortable_container"),n=document.querySelector("li.section a.modules"),o=n?n.parentNode:null,p=function(){var a=ENV.COURSE_ID||ENV.course_id;if(!a){var b=window.location.href.split("courses/")[1];b&&(a=b.split("/")[0])}return a}(),q=function(){return ENV.DOMAIN_ROOT_ACCOUNT_ID}(),r=function(a){const b=new URL(window.location.href),c=new URLSearchParams(b.search),d=c.get("module_item_id");if(d)return parseInt(d);else{const c=`/courses/${a}/modules/items/`;return b.href.includes(c)?parseInt(window.location.pathname.replace(c,"")):0}}(p),s=function(){const a=window.location.hash.substr(1),b="module_";return a.startsWith(b)?parseInt(a.replace(b,"")):0}();if(!p||!q)return;const t=ENV.FORCE_CPN||(await a(q,p));if(!t)return;s&&function(a){var b=document.querySelectorAll(`div.context_module:not([data-module-id='${a}'])`);b.forEach(a=>a.remove())}(s);const u=await b(p,null);if(u.length){if(m&&!s&&k){k.remove();const a=c(p,u);l.appendChild(a)}if(o){const a=d(p,u,s,r);o.appendChild(a)}if(r){let a=document.querySelector(".module-sequence-footer-content");let b=0,c=setInterval(()=>{if(a=document.querySelector(".module-sequence-footer-content"),b++,b>=100)return void clearInterval(c);if(a){const b=u.find(a=>a.items.find(a=>a.id===r)),d=e(p,r,b),g=f(d);a.appendChild(g),clearInterval(c)}},100)}}})();